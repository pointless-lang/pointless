<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <title>tables</title>
  </head>

  <body>
    <main>
      <p>
        <a
          href="https://www.sumsar.net/blog/pandas-feels-clunky-when-coming-from-r/"
          >https://www.sumsar.net/blog/pandas-feels-clunky-when-coming-from-r/</a
        >
      </p>
      <div class="snippet">
        <pre><code class="ptls">purchases <span class="operator">=</span> <span class="keyword">import</span> <span class="string">&quot;csv:purchases.csv&quot;</span></code></pre>
        <pre class="result">
<code><div class="var-name">purchases</div>┌───────────┬────────┬──────────┐
│ country   │ amount │ discount │ x 32
├───────────┼────────┼──────────┤
│ USA       │   2000 │       10 │
│ USA       │   3500 │       15 │
│ USA       │   3000 │       20 │
│ Canada    │    120 │       12 │
│ Canada    │    180 │       18 │
│ Canada    │   3100 │       21 │
│ UK        │    130 │       13 │
│ UK        │    160 │       16 │
│ UK        │    190 │       19 │
│ France    │    110 │       11 │
│ France    │    170 │       17 │
│ France    │    220 │       22 │
│ Germany   │    140 │       14 │
│ Germany   │    200 │       20 │
│ Germany   │    230 │       23 │
│ Australia │    150 │       15 │
│ Australia │    210 │       21 │
│ Australia │    240 │       24 │
│ Italy     │    160 │       16 │
│ Italy     │    220 │       22 │
│ Italy     │    250 │       25 │
│ Spain     │    170 │       17 │
│ Spain     │    230 │       23 │
│ Spain     │    260 │       26 │
│ Japan     │    180 │       18 │
│ Japan     │    240 │       24 │
│ Japan     │    270 │       27 │
│ India     │    190 │       19 │
│ India     │    250 │       25 │
│ India     │    280 │       28 │
│ Brazil    │    200 │       20 │
│ Brazil    │    260 │       26 │
└───────────┴────────┴──────────┘</code></pre>
      </div>
      <div class="snippet">
        <pre><code class="ptls"><span class="call">sum</span>(purchases.amount)</code></pre>
        <pre class="result"><code>17210</code></pre>
      </div>
      <div class="snippet">
        <pre>
<code class="ptls"><span class="keyword">fn</span> <span class="function">calcTotal</span>(<span class="argument">group</span>)
  { total: <span class="call">sum</span>(group.amount) }
<span class="keyword">end</span>

<span class="std">table</span>.<span class="call">summarize</span>(purchases, <span class="string">&quot;country&quot;</span>, calcTotal)</code></pre>
        <pre class="result">
<code>┌───────────┬───────┐
│ country   │ total │ x 11
├───────────┼───────┤
│ USA       │  8500 │
│ Canada    │  3400 │
│ UK        │   480 │
│ France    │   500 │
│ Germany   │   570 │
│ Australia │   600 │
│ Italy     │   630 │
│ Spain     │   660 │
│ Japan     │   690 │
│ India     │   720 │
│ Brazil    │   460 │
└───────────┴───────┘</code></pre>
      </div>
      <div class="snippet">
        <pre>
<code class="ptls"><span class="keyword">fn</span> <span class="function">calcTotal</span>(<span class="argument">group</span>)
  <span class="argument">total</span> <span class="operator">=</span> group
    <span class="operator">$</span> <span class="keyword">arg</span>.amount <span class="operator">-</span> <span class="keyword">arg</span>.discount
    <span class="operator">|</span> <span class="call">sum</span>

  { total }
<span class="keyword">end</span>

<span class="std">table</span>.<span class="call">summarize</span>(purchases, <span class="string">&quot;country&quot;</span>, calcTotal)</code></pre>
        <pre class="result">
<code>┌───────────┬───────┐
│ country   │ total │ x 11
├───────────┼───────┤
│ USA       │  8455 │
│ Canada    │  3349 │
│ UK        │   432 │
│ France    │   450 │
│ Germany   │   513 │
│ Australia │   540 │
│ Italy     │   567 │
│ Spain     │   594 │
│ Japan     │   621 │
│ India     │   648 │
│ Brazil    │   414 │
└───────────┴───────┘</code></pre>
      </div>
      <div class="snippet">
        <pre>
<code class="ptls">median <span class="operator">=</span> <span class="std">list</span>.<span class="call">median</span>(purchases.amount)

purchases
  <span class="operator">?</span> <span class="keyword">arg</span>.amount <span class="operator">&lt;=</span> median <span class="operator">*</span> <span class="number">10</span>
  <span class="operator">|</span> <span class="std">table</span>.<span class="call">summarize</span>(<span class="string">&quot;country&quot;</span>, calcTotal)</code></pre>
        <pre class="result">
<code>┌───────────┬───────┐
│ country   │ total │ x 10
├───────────┼───────┤
│ Canada    │   270 │
│ UK        │   432 │
│ France    │   450 │
│ Germany   │   513 │
│ Australia │   540 │
│ Italy     │   567 │
│ Spain     │   594 │
│ Japan     │   621 │
│ India     │   648 │
│ Brazil    │   414 │
└───────────┴───────┘</code></pre>
      </div>
      <div class="snippet">
        <pre>
<code class="ptls"><span class="keyword">fn</span> <span class="function">calcTotal</span>(<span class="argument">group</span>)
  <span class="argument">threshold</span> <span class="operator">=</span> <span class="std">list</span>.<span class="call">median</span>(group.amount) <span class="operator">*</span> <span class="number">10</span>

  total <span class="operator">=</span> group
    <span class="operator">?</span> <span class="keyword">arg</span>.amount <span class="operator">&lt;=</span> threshold
    <span class="operator">$</span> <span class="keyword">arg</span>.amount <span class="operator">-</span> <span class="keyword">arg</span>.discount
    <span class="operator">|</span> <span class="call">sum</span>

  { total }
<span class="keyword">end</span>

<span class="std">table</span>.<span class="call">summarize</span>(purchases, <span class="string">&quot;country&quot;</span>, calcTotal)</code></pre>
        <pre class="result">
<code>┌───────────┬───────┐
│ country   │ total │ x 11
├───────────┼───────┤
│ USA       │  8455 │
│ Canada    │   270 │
│ UK        │   432 │
│ France    │   450 │
│ Germany   │   513 │
│ Australia │   540 │
│ Italy     │   567 │
│ Spain     │   594 │
│ Japan     │   621 │
│ India     │   648 │
│ Brazil    │   414 │
└───────────┴───────┘</code></pre>
      </div>
    </main>
  </body>
</html>
